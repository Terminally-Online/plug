// SPDX-License-Identifier: MIT

pragma solidity 0.8.23;

import { PlugLib } from "../libraries/Plug.Lib.sol";
import { PlugFactory } from "../base/Plug.Factory.sol";
import { PlugSocket } from "../base/Plug.Socket.sol";
import { Plug } from "../base/Plug.sol";

interface ImmutableCreate2Factory {
    function safeCreate2(
        bytes32 salt,
        bytes calldata initCode
    )
        external
        payable
        returns (address deploymentAddress);

    function findCreate2Address(
        bytes32 salt,
        bytes calldata initCode
    )
        external
        view
        returns (address deploymentAddress);

    function findCreate2AddressViaHash(
        bytes32 salt,
        bytes32 initCodeHash
    )
        external
        view
        returns (address deploymentAddress);
}

/**
 * @title Plug Etcher
 * @notice This contract is the basis of the automatically generated Plug Etcher
 *         contract used to deploy and write the proper addresses. If you need to add
 *         a new etch into the vm stack for testing, you will do so through the file
 *         found at: /lib/functions/etcher.ts
 * @notice A good portion of this model comes from:
 *         https://github.com/Vectorized/multicaller/blob/main/src/MulticallerEtcher.sol
 *         I am not a Foundry expert. If there is a better way to do this, please let me
 *         know because this is a lot of work just to get a contract deployed when you're
 *         doing anything more than a simple in-and-out contract.
 * @author vectorized (twitter:@optimizoor)
 */
library PlugEtcherLib {
    /// @notice The immutable Create2 factory used for deployment.
    ImmutableCreate2Factory internal constant FACTORY =
        ImmutableCreate2Factory(0x0000000000FFe8B47B3e2130213B802212439497);

    bytes internal constant PLUG_FACTORY_INITCODE =
        hex"60808060405234610016576105e9908161001c8239f35b600080fdfe6080604081815260048036101561001557600080fd5b600092833560e01c91826277436014610175575050806375fd9f281461013057637ac4ed641461004457600080fd5b3461012c57807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261012c579073ffffffffffffffffffffffffffffffffffffffff6020926101096100966105b4565b90604051917fcc3735a920a3ca505d382bbc545af43d6000803e6038573d6000fd5b3d6000f36060527f5155f3363d3d373d3d363d7f360894a13ba1a3210667c828492db98dca3e2076604052616009602052601e5268603d3d8160223d3973600a52605f602120916040526000606052565b60ff84536035523060601b60015260243560155260558320926035525191168152f35b5080fd5b503461012c5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261012c5760209061016e6100966105b4565b9051908152f35b848491602091827ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105b15781359467ffffffffffffffff908187116105ad57366023880112156105ad57868401358281116105a957366024828a0101116105a95760801161054f575060448601359173ffffffffffffffffffffffffffffffffffffffff93848416928560848a0135169889158015610547575b6104f3578851997fffffffffffffffffffffffffffffffffffffffff000000000000000000000000898c01977fffffffffffffffffffffffff0000000000000000000000000000000000000000602485013560a01b16895260601b16602c8c0152888b52898b01908b8210848311176104c757818b528b519751978a8110610495575b5085977fcc3735a920a3ca505d382bbc545af43d6000803e6038573d6000fd5b3d6000f36060527f5155f3363d3d373d3d363d7f360894a13ba1a3210667c828492db98dca3e20768c526160098b5281601e5268603d3d8160223d3973600a52605f9881605560219f605f60212060758201523060581b875260ff87530152605584209934159e8b3b1561046f5750505060019c6104655786388180348d5af115610459578b9c838c9d5b5287606052159b8c610360575b8c8e918c8c8451931584521690820152f35b837f32c7564be3bbeabe66360c08d019367b0d744fcb948046d92552c00c9743dd10928a9552a386861690813b15610455578a517f485cc95500000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff96871685820190815260649290920135891690961660208201528491869182908490829060400103925af1801561044b5761040c575b808080808a61034e565b831161041f575050855285808080610402565b9060416024927f4e487b7100000000000000000000000000000000000000000000000000000000835252fd5b89513d85823e3d90fd5b8480fd5b8563b12d13eb8852601cfd5b8b9c838c9d610341565b90919e50829a5034f5978815610489578b9c838c9d610341565b8563301164258852601cfd5b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff908b0360031b1b909716968c610296565b6024866041877f4e487b7100000000000000000000000000000000000000000000000000000000835252fd5b88517f54f044c400000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff808c16828601908152908716602082015281906040010390fd5b508415610213565b8085857f08c379a00000000000000000000000000000000000000000000000000000000060649452820152601760248201527f506c7567436f72653a73616c742d6d616c666f726d65640000000000000000006044820152fd5b8380fd5b8280fd5b80fd5b6004359073ffffffffffffffffffffffffffffffffffffffff821682036105d757565b600080fdfea164736f6c6343000817000a";

    bytes32 internal constant PLUG_FACTORY_SALT =
        0x000000000000000000000000000000000000000061c1000389a9252cac99c238;

    address internal constant PLUG_FACTORY_ADDRESS = 0x0000000023EED31B68094b96810B68546A29A1Cd;

    bytes internal constant PLUG_SOCKET_INITCODE =
        hex"60a0806040523461007557306080526001638b78c6d81955600160007f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a3600160005260026020526040600020600160ff19825416179055612b46908161007b823960805181818161090c0152610a1a0152f35b600080fdfe60806040526004361015610015575b366119df57005b60003560e01c806306fdde03146101e55780630d6a5f4d146101e05780631e2950fb146101db57806325692962146101d657806327020df5146101d157806334bb3700146101cc578063485cc955146101c75780634f1ef286146101c257806352d1902d146101bd57806354d1f13d146101b857806354fd4d50146101b357806360cd27ad146101ae5780636f69f3d6146101a9578063715018a6146101a4578063733564b71461019f578063812a47291461019a578063816a1e5f1461019557806385ab746d146101905780638954bf061461018b5780638da5cb5b1461018657806395d89b4114610181578063969f7e1b1461017c578063b496003d14610177578063c2fb26a614610172578063dfe86ac51461016d578063e7d1bfc714610168578063f04e283e14610163578063f2fde38b1461015e5763fee81cf40361000e576114d5565b611495565b61143f565b611366565b611348565b611285565b611214565b6111d9565b611127565b6110ef565b61109a565b611005565b610d9e565b610d3f565b610cfa565b610c3a565b610b4c565b610acb565b610aaf565b610a68565b610a06565b6108bb565b610807565b610752565b610717565b6106c8565b6106b0565b610690565b610246565b60005b8381106101fd5750506000910152565b81810151838201526020016101ed565b90601f19601f60209361022b815180928187528780880191016101ea565b0116010190565b90602061024392818152019061020d565b90565b3461027a57600060031936011261027a57610276610262611530565b60405191829160208352602083019061020d565b0390f35b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6080810190811067ffffffffffffffff8211176102ca57604052565b61027f565b6040810190811067ffffffffffffffff8211176102ca57604052565b60c0810190811067ffffffffffffffff8211176102ca57604052565b90601f601f19910116810190811067ffffffffffffffff8211176102ca57604052565b60405190610337826102cf565b565b73ffffffffffffffffffffffffffffffffffffffff81160361027a57565b359061033782610339565b67ffffffffffffffff81116102ca5760051b60200190565b60ff81160361027a57565b67ffffffffffffffff81116102ca57601f01601f191660200190565b9291926103ad82610385565b916103bb6040519384610307565b82948184528183011161027a578281602093846000960137010152565b9080601f8301121561027a57816020610243933591016103a1565b919082608091031261027a5760405161040b816102ae565b6060808294803561041b8161037a565b8452602081013560208501526040810135604085015201359161043d8361037a565b0152565b81601f8201121561027a57803590602061045a83610362565b9360409061046b6040519687610307565b848652828601918360a08097028601019482861161027a578401925b858410610498575050505050505090565b868484031261027a5784879183516104af816102cf565b863581526104bf868489016103f3565b83820152815201930192610487565b91909160a08184031261027a576040519067ffffffffffffffff9060a08301828111848210176102ca57604052829481356105088161037a565b845261051660208301610357565b6020850152604082013583811161027a57816105339184016103d8565b604085015260608201356060850152608082013592831161027a5760809261055b9201610441565b910152565b81601f8201121561027a5780359160209161057a84610362565b936105886040519586610307565b808552838086019160051b8301019280841161027a57848301915b8483106105b35750505050505090565b823567ffffffffffffffff811161027a5786916105d5848480948901016104ce565b8152019201916105a3565b919060808382031261027a57604051906105f9826102ae565b8193803561060681610339565b835267ffffffffffffffff91602082013583811161027a578161062a918401610560565b6020850152604082013583811161027a57816106479184016103d8565b6040850152606082013592831161027a5760609261055b92016103d8565b602060031982011261027a576004359067ffffffffffffffff821161027a57610243916004016105e0565b3461027a5760206106a86106a336610665565b611569565b604051908152f35b3461027a5760206106a86106c336610665565b6115fc565b6000806003193601126107145763389a75e1600c523381526202a30042016020600c2055337fdbf36a107da19e49527a7176a1babf963b4b0ff8cde35ee35d6cd8f1f9ac7e1d8280a280f35b80fd5b3461027a57602060031936011261027a5760043567ffffffffffffffff811161027a576106a861074d60209236906004016104ce565b61164b565b3461027a5760031960208136011261027a5760043567ffffffffffffffff9182821161027a57608090823603011261027a57604051610790816102ae565b816004013583811161027a576107ac90600436918501016103d8565b8152602482013592831161027a5760646107f7926107d361027695600436918401016103d8565b60208401526044810135604084015201356107ed81610339565b60608201526116f6565b6040519081529081906020820190565b3461027a57604060031936011261027a5760043561082481610339565b6024359061083182610339565b73ffffffffffffffffffffffffffffffffffffffff8091169182638b78c6d81955600092837f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a31680610884575080f35b815260026020526040812060017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0082541617905580f35b604060031936011261027a576004356108d381610339565b60243567ffffffffffffffff9182821161027a573660238301121561027a57816004013592831161027a57366024848401011161027a577f000000000000000000000000000000000000000000000000000000000000000030146109f85773ffffffffffffffffffffffffffffffffffffffff9061094f611a17565b16913d9260009384526352d1902d6001527f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc9182602060016004601d865afa51036109ea5780828694817fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b8780a2556109c6578280f35b806024604051950185378338925af4156109e1578181808280f35b903d90823e3d90fd5b6355299b496001526004601dfd5b639f03a0266000526004601cfd5b3461027a57600060031936011261027a57307f0000000000000000000000000000000000000000000000000000000000000000036109f85760206040517f360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc8152f35b6000806003193601126107145763389a75e1600c52338152806020600c2055337ffa7b8eab7da67f412cc9575ed43464468f9bfbae89d1675917346ca6d8fe3c928280a280f35b3461027a57600060031936011261027a5761027661026261177b565b3461027a57602060031936011261027a5773ffffffffffffffffffffffffffffffffffffffff600435610afd81610339565b166000526002602052602060ff604060002054166040519015158152f35b9181601f8401121561027a5782359167ffffffffffffffff831161027a576020808501948460051b01011161027a57565b3461027a5760408060031936011261027a5767ffffffffffffffff9060043582811161027a57610b80903690600401610b1b565b909260243590811161027a57610b9a903690600401610b1b565b610ba5939193611a17565b60005b838110610bb157005b610bbc8183876117e3565b3590811515820361027a57610c3460019273ffffffffffffffffffffffffffffffffffffffff610bed84898c6117e3565b35610bf781610339565b166000526002602052856000209060ff7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0083541691151516179055565b01610ba8565b60008060031936011261071457610c4f611a17565b80638b78c6d8198181547f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08280a35580f35b60031960208183011261027a576004359167ffffffffffffffff9182841161027a57604090848303011261027a5760405192610cbc846102cf565b806004013583811161027a57826004610cd7928401016105e0565b8452602481013592831161027a57610cf292016004016103d8565b602082015290565b3461027a576020610d21610d0d36610c81565b82610d1882516115fc565b91015190611a7b565b73ffffffffffffffffffffffffffffffffffffffff60405191168152f35b3461027a57602060031936011261027a5760043567ffffffffffffffff811161027a576106a8610d756020923690600401610441565b61184d565b606060206102439381845260ff81511682850152015191604080820152019061020d565b60031960408136011261027a5760043567ffffffffffffffff811161027a5760408160040192823603011261027a5760243591610dda83610339565b610de2611896565b5068929eee149b4bd212689130835414610ff757610e2f90308455610e29610e226024610e1a6106c3610e1588806118b0565b611b25565b930185611b30565b36916103a1565b90611a7b565b610e6c610e5b610e55610e4f610e4586806118b0565b6060810190611b30565b90611b81565b60a01c90565b6bffffffffffffffffffffffff1690565b6001610e8f826001908060081c6000528160205260ff60406000205491161c1690565b151514610fa357610eb9908060081c6000526001602052600160ff604060002092161b8154179055565b610eed610ee68273ffffffffffffffffffffffffffffffffffffffff166000526002602052604060002090565b5460ff1690565b908115610f79575b5015610f215761027692610f0c82610f11936118b0565b612632565b9038905560405191829182610d7a565b60405163cd0e140160e01b815280610f756004820160809060ff815260406020820152601a60408201527f506c7567436f72653a7369676e61747572652d696e76616c696400000000000060608201520190565b0390fd5b638b78c6d8195473ffffffffffffffffffffffffffffffffffffffff908116911614905038610ef5565b60405163cd0e140160e01b815280610f756004820160809060ff815260406020820152601660408201527f506c7567436f72653a6e6f6e63652d696e76616c69640000000000000000000060608201520190565b63ab143c066000526004601cfd5b3461027a5760a060031936011261027a57604051611022816102cf565b600435815260807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdc36011261027a576106a8602091604051611063816102ae565b60243561106f8161037a565b815260443584820152606435604082015260843561108c8161037a565b6060820152838201526118e3565b3461027a57608060031936011261027a5760206106a86040516110bc816102ae565b6004356110c88161037a565b81526024358382015260443560408201526064356110e58161037a565b6060820152611935565b3461027a57600060031936011261027a576020638b78c6d8195473ffffffffffffffffffffffffffffffffffffffff60405191168152f35b3461027a5760008060031936011261071457611141611530565b805160408051938285526020908094815b8581106111a65787876005811161119e575b801561118b575b80601f19918352820161118660208201938460405284610232565b030190f35b5064504c5547536020820152600461116b565b506005611164565b838183010151831a605b8110868211166111c4575b50600101611152565b8760019298918684938c0101530196906111bb565b3461027a57602060031936011261027a5760043567ffffffffffffffff811161027a576106a861120f6020923690600401610560565b61199c565b3461027a57602061122436610c81565b8161122f8251611569565b91015182815191012060405190838201927f4223462a204a553d0ecb26b955c1f59fcf6a0662da793ddfd0d17a33c99b97f28452604083015260608201526060815261127a816102ae565b519020604051908152f35b3461027a57600060031936011261027a5761132360406000606082516112aa816102ae565b818152816020820152828482015201526112c2611530565b9073ffffffffffffffffffffffffffffffffffffffff6112e061177b565b918051936112ed856102ae565b84526020840192835261133681850193468552606086019230845280519788976020895251608060208a015260a089019061020d565b915190601f19888403019088015261020d565b92516060850152511660808301520390f35b3461027a57600060031936011261027a576020600054604051908152f35b60031960208136011261027a576004359067ffffffffffffffff821161027a57608090823603011261027a5761139a611896565b5068929eee149b4bd2126830815414610ff75730815573ffffffffffffffffffffffffffffffffffffffff638b78c6d819541633148015611436575b156113ea57610f1161027692600401611db6565b608460405163cd0e140160e01b815260ff600482015260406024820152601760448201527f506c7567436f72653a73656e6465722d696e76616c69640000000000000000006064820152fd5b503033146113d6565b602060031936011261027a5760043561145781610339565b61145f611a17565b63389a75e1600c52806000526020600c2090815442116114875760006114859255611a34565b005b636f5e88186000526004601cfd5b602060031936011261027a576004356114ad81610339565b6114b5611a17565b8060601b156114c75761148590611a34565b637448fbae6000526004601cfd5b3461027a57602060031936011261027a576004356114f281610339565b63389a75e1600c52600052602080600c2054604051908152f35b604051906020820182811067ffffffffffffffff8211176102ca5760405260008252565b6040519061153d826102cf565b600b82527f506c756720536f636b65740000000000000000000000000000000000000000006020830152565b73ffffffffffffffffffffffffffffffffffffffff8151169061158f602082015161199c565b90606060408201516020815191012091015160208151910120906040519260208401947fad37dd17963f530e0696a34fb50e96c004ad0a3380a5e9c1dc82de9eb692b5d9865260408501526060840152608083015260a082015260a081526115f6816102eb565b51902090565b61160860005491611569565b6040519060208201927f1901000000000000000000000000000000000000000000000000000000000000845260228301526042820152604281526115f6816102ae565b60ff8151169073ffffffffffffffffffffffffffffffffffffffff602082015116906040810151602081519101209061168c6080606083015192015161184d565b916040519360208501957f8adbed414e194dcdb13ff4e505a6ab838020fe2e144c9d773a6a63b399104584875260408601526060850152608084015260a083015260c082015260c0815260e0810181811067ffffffffffffffff8211176102ca5760405251902090565b805160208151910120906020810151602081519101209073ffffffffffffffffffffffffffffffffffffffff6060604083015192015116906040519260208401947f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f865260408501526060840152608083015260a082015260a081526115f6816102eb565b60405190611788826102cf565b600582527f302e302e310000000000000000000000000000000000000000000000000000006020830152565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b91908110156117f35760051b0190565b6117b4565b3561024381610339565b80518210156117f35760209160051b010190565b604061033791939293815194816118378793518092602080870191016101ea565b8201906020820152036020810185520183610307565b6060906000908051905b81831061186b575050506020815191012090565b90919261188d6001916118876118818786611802565b516118e3565b90611816565b93019190611857565b604051906118a3826102cf565b6060602083600081520152565b9035907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff818136030182121561027a570190565b6118f260208251920151611935565b6040519060208201927f85c9aec0e14ad33e63489c03355fa65515340a998cc26cd360d11267b451b6fd845260408301526060820152606081526115f6816102ae565b60ff8151169060208101519060ff6060604083015192015116906040519260208401947ff8939514938e0a800705081290e2e4c7efcf49061b28bf5b38f457c851eb82ac865260408501526060840152608083015260a082015260a081526115f6816102eb565b6060906000908051905b8183106119ba575050506020815191012090565b9091926119d66001916118876119d08786611802565b5161164b565b930191906119a6565b60003560e01c63bc197c81811463f23a6e6182141763150b7a02821417611a0e57633c10b94e6000526004601cfd5b6020526020603cf35b638b78c6d819543303611a2657565b6382b429006000526004601cfd5b73ffffffffffffffffffffffffffffffffffffffff16638b78c6d8198181547f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0600080a355565b909160009160409360405191815180604014611aec57604114611aab5750505050638baa579f91505b526004601cfd5b606080830151861a6020528683015190525b845260208091015185526001608085825afa519383606052523d611ae85750638baa579f9150611aa4565b9050565b507f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff86830151601b8160ff1c0160205216606052611abd565b6102439036906105e0565b9035907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe18136030182121561027a570180359067ffffffffffffffff821161027a5760200191813603831361027a57565b7fffffffffffffffffffffffff000000000000000000000000000000000000000090358181169392600c8110611bb657505050565b600c0360031b82901b16169150565b9035907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe18136030182121561027a570180359067ffffffffffffffff821161027a57602001918160051b3603831361027a57565b90611c2382610362565b611c306040519182610307565b828152601f19611c408294610362565b019060005b828110611c5157505050565b806060602080938501015201611c45565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60ff1660ff8114611ca25760010190565b611c62565b91908110156117f35760051b810135907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff618136030182121561027a570190565b9035907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe18136030182121561027a570180359067ffffffffffffffff821161027a576020019160a082023603831361027a57565b91908110156117f35760a0020190565b356102438161037a565b9060208201809211611ca257565b91908201809211611ca257565b908160051b9180830460201490151715611ca257565b3d15611db1573d90611d9782610385565b91611da56040519384610307565b82523d6000602084013e565b606090565b611dbe611896565b5060408101611dcd8183611b30565b90506124e1575b50611de26020820182611bc5565b929050600091611df184611c19565b916000935b8560ff861610156124c757611e1b611e116020850185611bc5565b60ff881691611ca7565b611e2b610e226040830183611b30565b91611e396080830183611ce7565b600091505b808210611fd15750506001611e5b611e5584611d4b565b60ff1690565b03611ef75750600091611e7160208493016117f8565b602082519201905af4611e82611d86565b611e8f60ff871686611802565b52935b8415611ea757611ea190611c91565b93611df6565b6040805163cd0e140160e01b815260ff9290921660048301526024820152601460448201527f506c7567436f72653a706c75672d6661696c65640000000000000000000000006064820152608490fd5b60ff611f0283611d4b565b16611f3e5750600091611f1860208493016117f8565b82602083519301915af1611f2a611d86565b611f3760ff871686611802565b5293611e92565b600260ff611f4b84611d4b565b1603611f79575060009181611f6360208594016117f8565b6060602084519401920135905af1611f2a611d86565b959190600360ff611f8983611d4b565b1614611f97575b5050611e92565b600092965090611faa60208493016117f8565b602082519201905afa611fbb611d86565b611fc860ff871686611802565b52933880611f90565b9093611fea85611fe46080870187611ce7565b90611d3b565b90612003611ffd611e5560208501611d4b565b8a611802565b51612013611e5560808501611d4b565b156123c55760208335820101519080518210156123745760208282010151916120448361203f83611d55565b611d63565b82511061232357600160ff61205b60808801611d4b565b1603612194578261207160208385010151611d70565b116121435790612098915b6120928461203f61208c84611d55565b93611d55565b91612a98565b906120a78161203f8635611d55565b8351106120f2576120ea926120db85936120d66120cd6120e49561203f60019a35611d55565b955b3584612a1b565b612ac6565b92815191612a98565b90612ac6565b940190611e3e565b6040805163cd0e140160e01b815260ff8e1660048201526024810191909152601760448201527f506c7567436f72653a776f756c642d6f766572666c6f770000000000000000006064820152608490fd5b6040805163cd0e140160e01b815260ff8f1660048201526024810191909152601d60448201527f506c7567436f72653a61727261792d6c656e6774682d696e76616c69640000006064820152608490fd5b600360ff6121a460808801611d4b565b160361220d57602083106121bc57906120989161207c565b6040805163cd0e140160e01b815260ff8f1660048201526024810191909152601960448201527f506c7567436f72653a7374727563742d746f6f2d736d616c6c000000000000006064820152608490fd5b60048060ff61221e60808901611d4b565b160361229b578361223460208486010151611d70565b116122445750906120989161207c565b8d90610f7560405192839263cd0e140160e01b8452830160ff60809216815260406020820152601d60408201527f506c7567436f72653a6e65737465642d61727261792d696e76616c696400000060608201520190565b600560ff6122ab60808901611d4b565b161480612319575b6122c25750906120989161207c565b8d90610f7560405192839263cd0e140160e01b8452830160ff60809216815260406020820152601c60408201527f506c7567436f72653a6b65792d76616c75652d746f6f2d736d616c6c0000000060608201520190565b50604084106122b3565b6040805163cd0e140160e01b815260ff8f1660048201526024810191909152601760448201527f506c7567436f72653a696e76616c69642d6c656e6774680000000000000000006064820152608490fd5b6040805163cd0e140160e01b815260ff8e1660048201526024810191909152601760448201527f506c7567436f72653a696e76616c69642d6f66667365740000000000000000006064820152608490fd5b60608301359060408401356123da8382611d63565b825110612476579081612092846123f094611d63565b9083356123fd8282611d63565b84511061242557926120db600195936120d661241f6120e4956120ea98611d63565b956120cf565b6040805163cd0e140160e01b815260ff8f1660048201526024810191909152601760448201527f506c7567436f72653a776f756c642d6f766572666c6f770000000000000000006064820152608490fd5b6040805163cd0e140160e01b815260ff8f1660048201526024810191909152601660448201527f506c7567436f72653a6f75742d6f662d626f756e6473000000000000000000006064820152608490fd5b5093505050506124d561032a565b60ff8152610cf261150c565b60406124ed8284611b30565b9050106125de576124fe8183611b30565b504290351061258a57602061252873ffffffffffffffffffffffffffffffffffffffff9284611b30565b500135166125365738611dd4565b60405163cd0e140160e01b815280610f756004820160809060ff815260406020820152601760408201527f506c7567436f72653a736f6c7665722d696e76616c696400000000000000000060608201520190565b60405163cd0e140160e01b815280610f756004820160809060ff815260406020820152601760408201527f506c7567436f72653a736f6c7665722d6578706972656400000000000000000060608201520190565b60405163cd0e140160e01b815280610f756004820160809060ff815260406020820152601960408201527f506c7567436f72653a736f6c7665722d6d616c666f726d65640000000000000060608201520190565b9061263b611896565b506040820161264a8184611b30565b90506129bf575b50506126606020820182611bc5565b92905060009161266f84611c19565b916000935b8560ff861610156124c75761268f611e116020850185611bc5565b61269f610e226040830183611b30565b916126ad6080830183611ce7565b600091505b8082106127ef57505060016126c9611e5584611d4b565b0361271557506000916126df60208493016117f8565b602082519201905af46126f0611d86565b6126fd60ff871686611802565b52935b8415611ea75761270f90611c91565b93612674565b60ff61272083611d4b565b1661275c575060009161273660208493016117f8565b82602083519301915af1612748611d86565b61275560ff871686611802565b5293612700565b600260ff61276984611d4b565b160361279757506000918161278160208594016117f8565b6060602084519401920135905af1612748611d86565b959190600360ff6127a783611d4b565b16146127b5575b5050612700565b6000929650906127c860208493016117f8565b602082519201905afa6127d9611d86565b6127e660ff871686611802565b529338806127ae565b909361280285611fe46080870187611ce7565b90612815611ffd611e5560208501611d4b565b51612825611e5560808501611d4b565b156129655760208335820101519080518210156123745760208282010151916128518361203f83611d55565b82511061232357600160ff61286860808801611d4b565b16036128d5578261287e60208385010151611d70565b116121435790612898916120928461203f61208c84611d55565b906128a78161203f8635611d55565b8351106120f2576128cd926120db85936120d66120cd6120e49561203f60019a35611d55565b9401906126b2565b600360ff6128e560808801611d4b565b16036128fd57602083106121bc57906128989161207c565b60048060ff61290e60808901611d4b565b1603612934578361292460208486010151611d70565b116122445750906128989161207c565b600560ff61294460808901611d4b565b16148061295b575b6122c25750906128989161207c565b506040841061294c565b606083013590604084013561297a8382611d63565b8251106124765790816120928461299094611d63565b90833561299d8282611d63565b84511061242557926120db600195936120d661241f6120e4956128cd98611d63565b60406129cb8285611b30565b9050106125de576129dc8184611b30565b504290351061258a576129ef9083611b30565b5090602073ffffffffffffffffffffffffffffffffffffffff8092169201351603612536573880612651565b9190600092606093815183811115612a90575b8015612a88575b50828110612a4257505050565b60405194509182900391601f19910181601f840181165b808301518188015201908115612a7157908290612a59565b505050604081840160006020820152016040528252565b905038612a35565b925082612a2e565b805160609493929083811115612abe575b81811115612a885750828110612a4257505050565b925082612aa9565b91909160405192815191601f198091818060208701165b80830151818a015201908115612af557908290612add565b505050815191838601828060208601165b808401518184015201918215612b1e57918390612b06565b5050505060409101808401906000602083015284520160405256fea164736f6c6343000817000a";

    bytes32 internal constant PLUG_SOCKET_SALT =
        0x000000000000000000000000000000000000000006f1164bc9079e316e55efca;

    address internal constant PLUG_SOCKET_ADDRESS = 0x0000000065e63B493A879D2020EC08AA9f4EB042;

    bytes internal constant PLUG_INITCODE =
        hex"6080806040523461003857600080546001600160a01b0319166f23eed31b68094b96810b68546a29a1cd179055610f2d908161003e8239f35b600080fdfe6080604052600436101561001257600080fd5b6000803560e01c90816306fdde031461005a5750806395d89b4114610055578063996d9ed21461005057639987b20c1461004b57600080fd5b610293565b6101a2565b61013f565b346100b557806003193601126100b55761007460c0604052565b60046080527f506c75670000000000000000000000000000000000000000000000000000000060a05260405160208152806100b1602082016100db565b0390f35b80fd5b60005b8381106100cb5750506000910152565b81810151838201526020016100bb565b906080519182815260005b8381106101065750601f19601f8460006020809697860101520116010190565b8060209160a00151828285010152016100e6565b90601f19601f602093610138815180928187528780880191016100b8565b0116010190565b3461019d57600060031936011261019d576100b160405161015f81610340565b600481527f504c554700000000000000000000000000000000000000000000000000000000602082015260405191829160208352602083019061011a565b600080fd5b602060031936011261019d5767ffffffffffffffff60043581811161019d573660238201121561019d57806004013591821161019d5760246005923660248260051b8501011161019d57926000907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9d84360301915b8560ff82161061022357005b83611fe082841b16860101358381121561019d5761027761026a7f387ebc2286e5f30aa44f4fde230e7badbbf2ed0322ac8455948821987c41459e928733918a0101610aa8565b6040519182918583610401565b0390a160ff80911690811461028e57600101610217565b6103af565b60031960208136011261019d576004359067ffffffffffffffff821161019d57604090823603011261019d5761030c6102f17f387ebc2286e5f30aa44f4fde230e7badbbf2ed0322ac8455948821987c41459e923390600401610aa8565b604051918291600083526040602084015260408301906103de565b0390a1005b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6040810190811067ffffffffffffffff82111761035c57604052565b610311565b90601f601f19910116810190811067ffffffffffffffff82111761035c57604052565b6040519061039182610340565b565b67ffffffffffffffff811161035c57601f01601f191660200190565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b90604060206103fe9360ff8151168452015191816020820152019061011a565b90565b60409060ff6103fe949316815281602082015201906103de565b6040519061042882610340565b6060602083600081520152565b60ff81160361019d57565b81601f8201121561019d57805161045681610393565b926104646040519485610361565b8184526020828401011161019d576103fe91602080850191016100b8565b9060208282031261019d57815167ffffffffffffffff9283821161019d57019060408282031261019d57604051926104b984610340565b82516104c481610435565b8452602083015190811161019d576104dc9201610440565b602082015290565b73ffffffffffffffffffffffffffffffffffffffff81160361019d57565b90357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe18236030181121561019d57016020813591019167ffffffffffffffff821161019d57813603831361019d57565b601f8260209493601f19938186528686013760008582860101520116010190565b9190808252602080920192916000905b828210610591575050505090565b9091929360019085358152828601356105a981610435565b60ff809116848301526040808801359083015260608088013590830152608090818801356105d681610435565b169082015260a0908101950193920190610583565b90918092808252602080920191808260051b86010194846000915b848310610617575050505050505090565b90919293949596601f1982820301875287357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff618436030181121561019d5783019060a09060ff833561066881610435565b16815273ffffffffffffffffffffffffffffffffffffffff8784013561068d816104e4565b16878201526106b36040836106a482870187610502565b91909285015284840191610552565b9260608082013590830152608090818101357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe18236030181121561019d57019388853595019367ffffffffffffffff861161019d5785023603841361019d576001948994846107289487968503910152610573565b99019701959493019190610606565b92916040845281357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff818336030181121561019d57820160408086015273ffffffffffffffffffffffffffffffffffffffff8135610793816104e4565b16608086015260208101357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe18236030181121561019d578101906020823592019367ffffffffffffffff831161019d578260051b3603851361019d5761087f6108756108af938961086661085b61081c6103919b60209a608060a08701526101008601916105eb565b6108296040860186610502565b907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff809560c08782860301910152610552565b926060810190610502565b918c84030160e08d0152610552565b9184810190610502565b907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc08984030160608a0152610552565b94019073ffffffffffffffffffffffffffffffffffffffff169052565b6040513d6000823e3d90fd5b60009060033d116108e557565b905060046000803e60005160e01c90565b600060443d106103fe5760405160031991823d016004833e815167ffffffffffffffff918282113d6024840111176109545781840194855193841161095c573d8501016020848701011161095457506103fe92910160200190610361565b949350505050565b50949350505050565b6000809160233d1161097357565b9150506020600460003e600051600191565b3d156109b0573d9061099682610393565b916109a46040519384610361565b82523d6000602084013e565b606090565b604051906109c282610340565b600f82527f506c75673a656d7074792d6461746100000000000000000000000000000000006020830152565b90602082519201517fffffffff00000000000000000000000000000000000000000000000000000000908181169360048110610a2957505050565b60040360031b82901b16169150565b60405190610a4582610340565b601582527f506c75673a756e6b6e6f776e2d73656c6563746f7200000000000000000000006020830152565b91909160408184031261019d578051610a8981610435565b92602082015167ffffffffffffffff811161019d576103fe9201610440565b610b1990929192610ab761041b565b93610add610ac483610dbc565b73ffffffffffffffffffffffffffffffffffffffff1690565b91604051928380927f816a1e5f000000000000000000000000000000000000000000000000000000008252816000978896879360048401610737565b03925af1829181610cd3575b50610cce57506001610b356108d8565b806308c379a014610ca357634e487b7114610c48575b610b525750565b9150610b5c610985565b916004835110610c31577fcd0e1401000000000000000000000000000000000000000000000000000000007fffffffff00000000000000000000000000000000000000000000000000000000610bb1856109ee565b1603610c1a57604051908351936003198501908184526020925b828110610c065750505050601c610bf2929382010160405260208082518301019101610a71565b6104dc610bfd610384565b60ff9093168352565b818101602401518582018501528301610bcb565b509050610c25610384565b60fc81526104dc610a38565b509050610c3c610384565b60fb81526104dc6109b5565b610c50610965565b90610c5c575b50610b4b565b935050610c7b610c898294604051928391602083019190602083019252565b03601f198101835282610361565b610c91610384565b60fd8152905b60208201529238610c56565b50610cac6108f6565b80610cb75750610b4b565b9350508092610cc4610384565b60fe815290610c97565b925050565b610cf09192503d8085833e610ce88183610361565b810190610482565b9038610b25565b9035907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff818136030182121561019d570190565b356103fe816104e4565b9035907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe18136030182121561019d570180359067ffffffffffffffff821161019d5760200191813603831361019d57565b919082604091031261019d578151801515810361019d576020909201516103fe816104e4565b9160206103fe938181520191610552565b610dce610dc98280610cf7565b610d2a565b90813b15610df1575b5073ffffffffffffffffffffffffffffffffffffffff1690565b6040610e6791610e30610e26610e1f610ac460005473ffffffffffffffffffffffffffffffffffffffff1690565b9280610cf7565b6060810190610d34565b9190600084518096819582947e77436000000000000000000000000000000000000000000000000000000000845260048401610dab565b03925af1908115610f1b57600091610eea575b5073ffffffffffffffffffffffffffffffffffffffff82811690821614610dd7576040517f5a4be8f400000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff928316600482015291166024820152604490fd5b610f0c915060403d604011610f14575b610f048183610361565b810190610d85565b905038610e7a565b503d610efa565b6108cc56fea164736f6c6343000817000a";

    bytes32 internal constant PLUG_SALT =
        0x0000000000000000000000000000000000000000577220d83d90233e8cd7e004;

    address internal constant PLUG_ADDRESS = 0x00000000692d6895bC523Cf08948AA22d32e03B1;

    /**
     * @notice Deploy (if needed) and return the PlugFactory contract instance.
     * @return $plugFactory The PlugFactory contract instance.
     */
    function plugFactory() internal returns (PlugFactory $plugFactory) {
        require(
            keccak256(abi.encodePacked(type(PlugFactory).creationCode))
                == keccak256(abi.encodePacked(PLUG_FACTORY_INITCODE)),
            "PlugEtcherLib:invalid-initcode"
        );

        if (_extcodesize(PLUG_FACTORY_ADDRESS) == 0) {
            address reality = safeCreate2(PLUG_FACTORY_SALT, PLUG_FACTORY_INITCODE);
            require(reality == PLUG_FACTORY_ADDRESS, "PlugEtcherLib:unexpected-address");
        }

        $plugFactory = PlugFactory(payable(PLUG_FACTORY_ADDRESS));
    }

    /**
     * @notice Deploy (if needed) and return the PlugSocket contract instance.
     * @return $plugSocket The PlugSocket contract instance.
     */
    function plugSocket() internal returns (PlugSocket $plugSocket) {
        require(
            keccak256(abi.encodePacked(type(PlugSocket).creationCode))
                == keccak256(abi.encodePacked(PLUG_SOCKET_INITCODE)),
            "PlugEtcherLib:invalid-initcode"
        );

        if (_extcodesize(PLUG_SOCKET_ADDRESS) == 0) {
            address reality = safeCreate2(PLUG_SOCKET_SALT, PLUG_SOCKET_INITCODE);
            require(reality == PLUG_SOCKET_ADDRESS, "PlugEtcherLib:unexpected-address");
        }

        $plugSocket = PlugSocket(payable(PLUG_SOCKET_ADDRESS));
    }

    /**
     * @notice Deploy (if needed) and return the Plug contract instance.
     * @return $plug The Plug contract instance.
     */
    function plug() internal returns (Plug $plug) {
        require(
            keccak256(abi.encodePacked(type(Plug).creationCode))
                == keccak256(abi.encodePacked(PLUG_INITCODE)),
            "PlugEtcherLib:invalid-initcode"
        );

        if (_extcodesize(PLUG_ADDRESS) == 0) {
            address reality = safeCreate2(PLUG_SALT, PLUG_INITCODE);
            require(reality == PLUG_ADDRESS, "PlugEtcherLib:unexpected-address");
        }

        $plug = Plug(payable(PLUG_ADDRESS));
    }

    /**
     * @notice Deploys a contract via 0age's immutable create 2 factory for testing.
     * @param $salt The salt to use for the deployment.
     * @param $initializationCode The initialization code for the contract.
     * @return $deployment The address of the deployed contract.
     */
    function safeCreate2(
        bytes32 $salt,
        bytes memory $initializationCode
    )
        public
        returns (address $deployment)
    {
        // Canonical address of 0age's immutable create 2 factory.
        address c2f = 0x0000000000FFe8B47B3e2130213B802212439497;
        if (_extcodesize(c2f) == 0) {
            bytes memory ic2fBytecode =
                hex"60806040526004361061003f5760003560e01c806308508b8f1461004457806364e030871461009857806385cf97ab14610138578063a49a7c90146101bc575b600080fd5b34801561005057600080fd5b506100846004803603602081101561006757600080fd5b503573ffffffffffffffffffffffffffffffffffffffff166101ec565b604080519115158252519081900360200190f35b61010f600480360360408110156100ae57600080fd5b813591908101906040810160208201356401000000008111156100d057600080fd5b8201836020820111156100e257600080fd5b8035906020019184600183028401116401000000008311171561010457600080fd5b509092509050610217565b6040805173ffffffffffffffffffffffffffffffffffffffff9092168252519081900360200190f35b34801561014457600080fd5b5061010f6004803603604081101561015b57600080fd5b8135919081019060408101602082013564010000000081111561017d57600080fd5b82018360208201111561018f57600080fd5b803590602001918460018302840111640100000000831117156101b157600080fd5b509092509050610592565b3480156101c857600080fd5b5061010f600480360360408110156101df57600080fd5b508035906020013561069e565b73ffffffffffffffffffffffffffffffffffffffff1660009081526020819052604090205460ff1690565b600083606081901c33148061024c57507fffffffffffffffffffffffffffffffffffffffff0000000000000000000000008116155b6102a1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260458152602001806107746045913960600191505060405180910390fd5b606084848080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920182905250604051855195965090943094508b93508692506020918201918291908401908083835b6020831061033557805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe090920191602091820191016102f8565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff018019909216911617905260408051929094018281037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe00183528085528251928201929092207fff000000000000000000000000000000000000000000000000000000000000008383015260609890981b7fffffffffffffffffffffffffffffffffffffffff00000000000000000000000016602183015260358201969096526055808201979097528251808203909701875260750182525084519484019490942073ffffffffffffffffffffffffffffffffffffffff81166000908152938490529390922054929350505060ff16156104a7576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252603f815260200180610735603f913960400191505060405180910390fd5b81602001825188818334f5955050508073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff161461053a576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260468152602001806107b96046913960600191505060405180910390fd5b50505073ffffffffffffffffffffffffffffffffffffffff8116600090815260208190526040902080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff001660011790559392505050565b6000308484846040516020018083838082843760408051919093018181037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe001825280845281516020928301207fff000000000000000000000000000000000000000000000000000000000000008383015260609990991b7fffffffffffffffffffffffffffffffffffffffff000000000000000000000000166021820152603581019790975260558088019890985282518088039098018852607590960182525085519585019590952073ffffffffffffffffffffffffffffffffffffffff81166000908152948590529490932054939450505060ff909116159050610697575060005b9392505050565b604080517fff000000000000000000000000000000000000000000000000000000000000006020808301919091523060601b6021830152603582018590526055808301859052835180840390910181526075909201835281519181019190912073ffffffffffffffffffffffffffffffffffffffff81166000908152918290529190205460ff161561072e575060005b9291505056fe496e76616c696420636f6e7472616374206372656174696f6e202d20636f6e74726163742068617320616c7265616479206265656e206465706c6f7965642e496e76616c69642073616c74202d206669727374203230206279746573206f66207468652073616c74206d757374206d617463682063616c6c696e6720616464726573732e4661696c656420746f206465706c6f7920636f6e7472616374207573696e672070726f76696465642073616c7420616e6420696e697469616c697a6174696f6e20636f64652ea265627a7a723058202bdc55310d97c4088f18acf04253db593f0914059f0c781a9df3624dcef0d1cf64736f6c634300050a0032";
            /// @solidity memory-safe-assembly
            assembly {
                let m := mload(0x40)
                mstore(m, 0xb4d6c782) // `etch(address,bytes)`.
                mstore(add(m, 0x20), c2f)
                mstore(add(m, 0x40), 0x40)
                let n := mload(ic2fBytecode)
                mstore(add(m, 0x60), n)
                for { let i := 0 } lt(i, n) { i := add(0x20, i) } {
                    mstore(add(add(m, 0x80), i), mload(add(add(ic2fBytecode, 0x20), i)))
                }
                let vmAddress := 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D
                if iszero(call(gas(), vmAddress, 0, add(m, 0x1c), add(n, 0x64), 0x00, 0x00)) {
                    revert(0, 0)
                }
            }
        }
        /// @solidity memory-safe-assembly
        assembly {
            let m := mload(0x40)
            let n := mload($initializationCode)
            mstore(m, 0x64e03087) // `safeCreate2(bytes32,bytes)`.
            mstore(add(m, 0x20), $salt)
            mstore(add(m, 0x40), 0x40)
            mstore(add(m, 0x60), n)
            // prettier-ignore
            for { let i := 0 } lt(i, n) { i := add(i, 0x20) } {
                mstore(add(add(m, 0x80), i), mload(add(add($initializationCode, 0x20), i)))
            }
            if iszero(call(gas(), c2f, 0, add(m, 0x1c), add(n, 0x64), m, 0x20)) {
                returndatacopy(m, m, returndatasize())
                revert(m, returndatasize())
            }
            $deployment := mload(m)
        }
    }

    /**
     * @notice Determine and retrieve the extcodesize of `deployment`.
     * @param $deployment The address to check.
     * @return $result The size of the code at `deployment`.
     */
    function _extcodesize(address $deployment) private view returns (uint256 $result) {
        /// @solidity memory-safe-assembly
        assembly {
            $result := extcodesize($deployment)
        }
    }
}
