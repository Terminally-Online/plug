import{_ as s,o as e,c as n,Q as a}from"./chunks/framework.850b4e59.js";const u=JSON.parse(`{"title":"Revocation","description":"Details of pin revocation and why it's important.","frontmatter":{"head":[["meta",{"property":"og:title","content":"Revocation"}],["meta",{"name":"description","content":"Details of pin revocation and why it's important."}],["meta",{"property":"og:description","content":"Details of pin revocation and why it's important."}]]},"headers":[],"relativePath":"instances/enforcers/revocation.md","filePath":"instances/enforcers/revocation.md","lastUpdated":1699738671000}`),o={name:"instances/enforcers/revocation.md"},t=a(`<h1 id="revocation" tabindex="-1">Revocation <a class="header-anchor" href="#revocation" aria-label="Permalink to &quot;Revocation&quot;">​</a></h1><p>The concept of raw <strong>revocation</strong> is extremely simple: <strong><em>If you can give, you can take away.</em></strong> But, when it comes to transaction blockchains that are immutable, this becomes a bit more complex.</p><p>With typical native EVM transactions on Ethereum, there is no way to revoke a transaction. Once it&#39;s sent, it&#39;s sent. If you change your mind, you can&#39;t take it back. If the conditions change and you don&#39;t want to experience the consequences of the transaction, you can&#39;t take it back.</p><p>With <code>Plug</code>, you can with ease.</p><p>Importantly, this is enabled by precisely the same pin-stack as every other execution condition. Due to the modular design of <code>Plug</code>, unlocking this ability for the users of your protocol is extremely simple and only requires app-level logic.</p><h2 id="how-does-it-work" tabindex="-1">How does it work? <a class="header-anchor" href="#how-does-it-work" aria-label="Permalink to &quot;How does it work?&quot;">​</a></h2><p>As revocation is built on the same pin-stack as every other execution condition, it is extremely simple to implement. In fact, it is so simple that it is only a two-step process:</p><ol><li>Scope a <a href="/core/fuse.html">Revocation Enforcer</a> at the time of <strong>giving</strong> the pins.</li><li>Call the <code>revoke</code> function on the <a href="/core/fuse.html">Enforcer</a> <strong>originally declared</strong> in the pins.</li></ol><div class="info custom-block"><p class="custom-block-title">INFO</p><p>If you have been reading the documentation from top to bottom, you may not have gotten to the <a href="/core/fuse.html">Enforcers</a> section yet. If this is the case, you may want to read that section before continuing. For now, the simple explanation is that an <a href="/core/fuse.html">Enforcer</a> is what powers the &quot;<em>if this</em>&quot; part of the &quot;<em>if this, then that</em>&quot; logic of a pin.</p></div><h3 id="giving-revocable-pins" tabindex="-1">Giving Revocable Pins <a class="header-anchor" href="#giving-revocable-pins" aria-label="Permalink to &quot;Giving Revocable Pins&quot;">​</a></h3><p>The first step is to scope a <a href="/core/fuse.html">Revocation Enforcer</a> at the time of declaring the pin. This is done by adding the <code>RevocationEnforcer</code> to the <code>enforcers</code> array of the <code>Pin</code> struct.</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">pins</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  delegate: </span><span style="color:#9ECBFF;">&quot;&lt;the EVM address of the delegate&gt;&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  authority: </span><span style="color:#B392F0;">bytes32</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  fuses: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      enforcer: RevocationEnforcer.address,</span></span>
<span class="line"><span style="color:#E1E4E8;">      terms: </span><span style="color:#B392F0;">bytes</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">  salt: </span><span style="color:#B392F0;">bytes32</span><span style="color:#E1E4E8;">(Date.</span><span style="color:#B392F0;">now</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">()),</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">pins</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  delegate: </span><span style="color:#032F62;">&quot;&lt;the EVM address of the delegate&gt;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  authority: </span><span style="color:#6F42C1;">bytes32</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">  fuses: [</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      enforcer: RevocationEnforcer.address,</span></span>
<span class="line"><span style="color:#24292E;">      terms: </span><span style="color:#6F42C1;">bytes</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"><span style="color:#24292E;">  salt: </span><span style="color:#6F42C1;">bytes32</span><span style="color:#24292E;">(Date.</span><span style="color:#6F42C1;">now</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">()),</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>With the <code>RevocationEnforcer</code> scoped, the pins can now be signed and given to the delegate. If the pins given are ever used, first the <code>RevocationEnforcer</code> will be called to ensure that the they have not been revoked.</p><h3 id="revoking-pins" tabindex="-1">Revoking Pins <a class="header-anchor" href="#revoking-pins" aria-label="Permalink to &quot;Revoking Pins&quot;">​</a></h3><p>With the pins given, let&#39;s look at the implementation of the <code>revoke</code> function in the <code>Plug</code> framework contract in chunks to better understand how this works:</p><div class="language-solidity vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">revoke</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">LivePins</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">calldata</span><span style="color:#E1E4E8;"> $</span><span style="color:#FFAB70;">signedPins</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">bytes32</span><span style="color:#E1E4E8;"> $</span><span style="color:#FFAB70;">domainHash</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">public</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">revoke</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">LivePins</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">calldata</span><span style="color:#24292E;"> $</span><span style="color:#E36209;">signedPins</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">bytes32</span><span style="color:#24292E;"> $</span><span style="color:#E36209;">domainHash</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">public</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Notably, the <code>revoke</code> function takes two arguments: the <code>LivePins</code> and the <code>domainHash</code>.</p><ul><li>The <code>LivePins</code> is the same as the <code>LivePins</code> that was originally declared.</li><li>The <code>domainHash</code> is the same as the <code>domainHash</code> of the intent target (you may give the same pins for two different contracts).</li></ul><div class="language-solidity vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">require</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">getLivePinsSigner</span><span style="color:#E1E4E8;">($signedPins, $domainHash) </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">_msgSender</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;RevocationEnforcer:InvalidRevoker&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">require</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">getLivePinsSigner</span><span style="color:#24292E;">($signedPins, $domainHash) </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">_msgSender</span><span style="color:#24292E;">(),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;RevocationEnforcer:InvalidRevoker&#39;</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Now inside the function, the logic starts by ensuring that the <code>Sender</code> of the <code>revoke</code>transaction is the same as the<code>Signer</code>of the pins. This is important because it ensures that only the original<code>Signer</code> of the pins can revoke them.</p><div class="language-solidity vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">bytes32</span><span style="color:#E1E4E8;"> pinsHash </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getLivePinsHash</span><span style="color:#E1E4E8;">($signedPins);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">bytes32</span><span style="color:#24292E;"> pinsHash </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getLivePinsHash</span><span style="color:#24292E;">($signedPins);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Now that we know the caller is the signer of the pins, we need to determine the hash of the pins that are being revoked.</p><div class="language-solidity vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">require</span><span style="color:#E1E4E8;">(isRevoked[pinsHash] </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;RevocationEnforcer:AlreadyRevoked&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">require</span><span style="color:#24292E;">(isRevoked[pinsHash] </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;RevocationEnforcer:AlreadyRevoked&#39;</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Everything is going great, but before we can revoke the pins, we need to ensure that they have not already been revoked.</p><div class="language-solidity vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">solidity</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">isRevoked[pinsHash] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">isRevoked[pinsHash] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Finally, with all that work done, we can revoke the pins by setting the <code>isRevoked</code> mapping to <code>true</code>. All in all, not too complicated.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>It is very important to understand that when you revoke pins, it does so based on the hash of the pins given. If the user attempts to use that same set of pins (that encode to the same hash) again in the future, it will be rejected.</p><p>Due to this, it is recommended to use <code>salt</code> as an encoded timestamp to ensure that the hash is unique each time a set of pins are given.</p><p>Before moving on it is worth noting that the <code>LivePins</code> remain localized to the <code>domainHash</code> of the intent target. This means that if you revoke pins for one <code>domainHash</code>, it will not affect the pins for any other <code>domainHash</code>.</p></div>`,27),l=[t];function p(i,c,r,d,h,y){return e(),n("div",null,l)}const v=s(o,[["render",p]]);export{u as __pageData,v as default};
